name: Localstack

on:
  issue_comment:
    types: [created]

env:
  TF_VERSION: 1.0.3
  DEFAULT_REGION: "us-east-1"
  AWS_ACCOUNT_ID: "111111111111"
  AWS_ACCESS_KEY_ID: "test"
  AWS_SECRET_ACCESS_KEY: "test"

jobs:
  validation:
    if: (github.event.comment.body == 'localstack run')
    name: Localstack
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: Run docker-compose up
        id: docker_compose_up
        run: |
          ls
          pwd
          docker-compose -f localstack/docker-compose.yml up --force-recreate -d
          sleep 120
      - name: Check ps
        run: docker ps
      - name: Run docker-compose down
        id: docker_compose_down
        run: |
          ls
          pwd
          docker-compose -f localstack/docker-compose.yml down
      - name: Check ps
        run: docker ps